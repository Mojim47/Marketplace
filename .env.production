# ═══════════════════════════════════════════════════════════════════════════
# NextGen Marketplace - Production Environment Configuration
# ═══════════════════════════════════════════════════════════════════════════
# Copy this file to .env.production and fill in the values

# ═══════════════════════════════════════════════════════════════════════════
# DEPLOYMENT METADATA
# ═══════════════════════════════════════════════════════════════════════════

DEPLOYMENT_ENV=production
DEPLOYMENT_REGION=ir-tehran-01
DEPLOYMENT_VERSION=2026.1.0
DATA_PATH=/var/lib/nextgen/data

# ═══════════════════════════════════════════════════════════════════════════
# DATABASE CONFIGURATION (PostgreSQL 16)
# ═══════════════════════════════════════════════════════════════════════════

POSTGRES_IMAGE=postgres:16.4-alpine
POSTGRES_PORT=5432
DB_USER=nextgen_prod
DB_PASSWORD=change_me_to_secure_password_min_32_chars
DB_NAME=nextgen_marketplace_prod

# Connection string (constructed by docker-compose)
# DATABASE_URL=postgresql://nextgen_prod:password@postgres:5432/nextgen_marketplace_prod?schema=public&sslmode=require&statement_cache_size=0&statement_timeout=30000
DATABASE_URL=postgresql://nextgen_prod:change_me_to_secure_password_min_32_chars@postgres:5432/nextgen_marketplace_prod?schema=public

# Connection pool settings
DATABASE_POOL_SIZE=20
DATABASE_POOL_TIMEOUT=30000

# ═══════════════════════════════════════════════════════════════════════════
# CACHE CONFIGURATION (DragonflyDB/Redis)
# ═══════════════════════════════════════════════════════════════════════════

DRAGONFLY_IMAGE=docker.dragonflydb.io/dragonflydb/dragonfly:v1.15.1
REDIS_PORT=6379
REDIS_PASSWORD=change_me_to_secure_redis_password_min_32_chars

# REDIS_URL=redis://:password@redis:6379/0
REDIS_URL=redis://:change_me_to_secure_redis_password_min_32_chars@redis:6379/0

# Cache TTLs (seconds)
CACHE_TTL_DEFAULT=300
CACHE_TTL_PRODUCTS=600
CACHE_TTL_ORDERS=60
CACHE_TTL_ANALYTICS=300
CACHE_TTL_SESSIONS=86400

# ═══════════════════════════════════════════════════════════════════════════
# STORAGE CONFIGURATION (MinIO S3-Compatible)
# ═══════════════════════════════════════════════════════════════════════════

MINIO_IMAGE=minio/minio:RELEASE.2024-12-18T13-15-44Z
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=change_me_to_secure_minio_password_min_32_chars
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_DOMAIN=minio.marketplace.example.com
MINIO_ENDPOINT=minio
MINIO_USE_SSL=false
MINIO_PUBLIC_URL=https://storage.marketplace.example.com
MINIO_BUCKET_UPLOADS=uploads
MINIO_BUCKET_BACKUPS=backups

# ═══════════════════════════════════════════════════════════════════════════
# APPLICATION CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════

NODE_ENV=production
API_PORT=3001
WEB_PORT=3000
ADMIN_PORT=3003
API_PREFIX=/api

# Node.js optimization
NODE_OPTIONS=--max-old-space-size=1024 --enable-source-maps

# ═══════════════════════════════════════════════════════════════════════════
# CORS & SECURITY
# ═══════════════════════════════════════════════════════════════════════════

CORS_ORIGINS=https://marketplace.example.com,https://admin.marketplace.example.com
CORS_CREDENTIALS=true

# CSP Headers
CSP_API_DOMAIN=api.marketplace.example.com
CSP_CDN_DOMAIN=cdn.marketplace.example.com
CSP_ANALYTICS_DOMAIN=analytics.marketplace.example.com

# ═══════════════════════════════════════════════════════════════════════════
# JWT & AUTHENTICATION
# ═══════════════════════════════════════════════════════════════════════════

JWT_SECRET=change_me_to_secure_jwt_secret_256_bits_minimum
JWT_REFRESH_SECRET=change_me_to_secure_jwt_refresh_secret_256_bits_minimum
JWT_PRIVATE_KEY=change_me_to_private_key_content_base64_encoded
JWT_PUBLIC_KEY=change_me_to_public_key_content_base64_encoded
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# 2FA (TOTP)
TOTP_ENCRYPTION_KEY=change_me_to_secure_totp_encryption_key_32_chars

# Session
SESSION_SECRET=change_me_to_secure_session_secret_256_bits_minimum

# ═══════════════════════════════════════════════════════════════════════════
# FRONTEND URLS
# ═══════════════════════════════════════════════════════════════════════════

FRONTEND_URL=https://marketplace.example.com
NEXT_PUBLIC_SITE_URL=https://marketplace.example.com
NEXT_PUBLIC_API_BASE=https://api.marketplace.example.com
ADMIN_URL=https://admin.marketplace.example.com
ADMIN_API_PROXY_TARGET=http://api:3001
API_URL=https://api.marketplace.example.com

# ═══════════════════════════════════════════════════════════════════════════
# ZARINPAL PAYMENT GATEWAY
# ═══════════════════════════════════════════════════════════════════════════

ZARINPAL_MERCHANT_ID=change_me_to_zarinpal_merchant_id
ZARINPAL_SANDBOX=false
ZARINPAL_CALLBACK_URL=https://api.marketplace.example.com/api/v3/payments/zarinpal/callback
ZARINPAL_WEBHOOK_SECRET=change_me_to_zarinpal_webhook_secret
ZARINPAL_API_VERSION=v4
ZARINPAL_TIMEOUT=30000

# ═══════════════════════════════════════════════════════════════════════════
# MOODIAN (TAX AUTHORITY INTEGRATION)
# ═══════════════════════════════════════════════════════════════════════════

MOODIAN_CLIENT_ID=change_me_to_moodian_client_id
MOODIAN_PRIVATE_KEY=change_me_to_moodian_private_key_base64
MOODIAN_PUBLIC_KEY=change_me_to_moodian_public_key_base64
MOODIAN_TAX_ORG_PUBLIC_KEY=change_me_to_tax_org_public_key_base64
MOODIAN_MEMORY_ID=change_me_to_moodian_memory_id
MOODIAN_SANDBOX=false
MOODIAN_BASE_URL=https://tp.tax.gov.ir/req/api/self-tsp
MOODIAN_TIMEOUT=60000

# ═══════════════════════════════════════════════════════════════════════════
# COMPANY INFORMATION
# ═══════════════════════════════════════════════════════════════════════════

COMPANY_NAME=NextGen Marketplace
COMPANY_TAX_ID=14006547821
COMPANY_ECONOMIC_CODE=409710222222222
COMPANY_POSTAL_CODE=1234567890
COMPANY_ADDRESS=تهران، خیابان ولیعصر، پلاک ۱۲۳
COMPANY_PHONE=+98-21-12345678

# ═══════════════════════════════════════════════════════════════════════════
# LOGGING & MONITORING
# ═══════════════════════════════════════════════════════════════════════════

LOG_LEVEL=info
DEBUG=false
ENABLE_SWAGGER=false
ENABLE_METRICS=true
METRICS_PORT=9090

# ═══════════════════════════════════════════════════════════════════════════
# GRAFANA & PROMETHEUS
# ═══════════════════════════════════════════════════════════════════════════

GRAFANA_PASSWORD=change_me_to_secure_grafana_password
GRAFANA_URL=http://grafana:3000
PROMETHEUS_URL=http://prometheus:9090
PROMETHEUS_RETENTION=30d
ALERTMANAGER_URL=http://alertmanager:9093
ALERTMANAGER_WEBHOOK=http://alertmanager-webhook:5001/webhook
ENABLE_EMAIL_ALERTS=true

# ═══════════════════════════════════════════════════════════════════════════
# EMAIL ALERTS CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════

SMTP_HOST=smtp.company.com
SMTP_PORT=587
SMTP_USER=alerts@marketplace.example.com
SMTP_PASSWORD=change_me_to_smtp_password
FROM_EMAIL=alerts@marketplace.example.com
TO_EMAIL=ops@marketplace.example.com
ENABLE_EMAIL_ALERTS=true

# ═══════════════════════════════════════════════════════════════════════════
# RATE LIMITING
# ═══════════════════════════════════════════════════════════════════════════

RATE_LIMIT_GLOBAL=1000
RATE_LIMIT_INVENTORY=100
RATE_LIMIT_BIDDING=50
RATE_LIMIT_BULK=10

# ═══════════════════════════════════════════════════════════════════════════
# VALIDATION LIMITS
# ═══════════════════════════════════════════════════════════════════════════

VALIDATION_MAX_STRING_LENGTH=10000
VALIDATION_MAX_ARRAY_LENGTH=1000
VALIDATION_MAX_OBJECT_DEPTH=10
MAX_FILE_SIZE=10485760
ALLOWED_FILE_EXTENSIONS=.jpg,.jpeg,.png,.gif,.pdf,.doc,.docx,.glb,.usdz

# ═══════════════════════════════════════════════════════════════════════════
# LOCALIZATION
# ═══════════════════════════════════════════════════════════════════════════

DEFAULT_LANGUAGE=fa
DEFAULT_LOCALE=fa-IR
SUPPORTED_LANGUAGES=fa,en
TIMEZONE=Asia/Tehran
JALALI_CALENDAR=true
PERSIAN_NUMBERS=true

# ═══════════════════════════════════════════════════════════════════════════
# AWS S3 (Optional for backups/CDN)
# ═══════════════════════════════════════════════════════════════════════════

AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=change_me_if_using_aws_s3
AWS_SECRET_ACCESS_KEY=change_me_if_using_aws_s3
AWS_S3_BUCKET=nextgen-marketplace-files

# ═══════════════════════════════════════════════════════════════════════════
# PERFORMANCE TUNING
# ═══════════════════════════════════════════════════════════════════════════

SLOW_QUERY_THRESHOLD=100
ENABLE_QUERY_LOGGING=true
ENABLE_ANALYTICS=true

# ═══════════════════════════════════════════════════════════════════════════
# FEATURE FLAGS
# ═══════════════════════════════════════════════════════════════════════════

AI_EMBEDDING_ENABLED=true
AI_EMBEDDING_MODEL_PATH=/app/public/models/ai/all-MiniLM-L6-v2.onnx
AI_EMBEDDING_TOKENIZER_PATH=/app/public/models/ai/tokenizer.json
AI_EMBEDDING_MAX_LEN=128

# ═══════════════════════════════════════════════════════════════════════════
# MOCK SERVICES (DEVELOPMENT ONLY - SET TO false IN PRODUCTION)
# ═══════════════════════════════════════════════════════════════════════════

MOCK_ZARINPAL=false
MOCK_MOODIAN=false
MOCK_SMS=false
MOCK_EMAIL=false
ALLOW_AUTH_MOCK=false
AUTH_MODE=real

# ═══════════════════════════════════════════════════════════════════════════
# BACKUP & DISASTER RECOVERY
# ═══════════════════════════════════════════════════════════════════════════

BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * * # Every day at 2 AM
BACKUP_RETENTION_DAYS=7
BACKUP_DESTINATION=s3://nextgen-backups
BACKUP_ENCRYPTION=true

# ═══════════════════════════════════════════════════════════════════════════
# END OF CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════
# CRITICAL: All values marked with "change_me_" must be updated before deployment
# CRITICAL: Keep this file secure and never commit secrets to version control
# CRITICAL: Use a secrets manager (Vault, AWS Secrets Manager, etc.) in production
