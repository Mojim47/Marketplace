apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: internal-staging-ingress
  namespace: nextgen-staging
  annotations:
    kubernetes.io/ingress.class: "nginx"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/auth-tls-verify-client: "on"
    nginx.ingress.kubernetes.io/auth-tls-secret: "nextgen-staging/mtls-ca-secret"
    nginx.ingress.kubernetes.io/auth-tls-verify-depth: "1"
    nginx.ingress.kubernetes.io/auth-tls-error-page: "https://nextgen-market.ir/403"
spec:
  tls:
  - hosts:
    - internal-staging.nextgen-market.ir
    secretName: internal-staging-tls
  rules:
  - host: internal-staging.nextgen-market.ir
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: nextgen-api-staging
            port:
              number: 3001
---
apiVersion: v1
kind: Secret
metadata:
  name: mtls-ca-secret
  namespace: nextgen-staging
type: Opaque
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t... # Base64 encoded CA certificate
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: staging-config
  namespace: nextgen-staging
data:
  NODE_ENV: "staging"
  SWAGGER_ENABLED: "true"
  INTERNAL_DOMAIN: "true"